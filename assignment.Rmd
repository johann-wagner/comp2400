---
title: "COMP 2400 - Assignment 1"
author: "Johann Wagner, u6958957"
date: "2023-08-25"
output:  
    html_document:
        toc: true
        toc_depth: 4
        theme: cosmo
        number_sections: false
        toc_float: true
        highlight: pygments
        fig_width: 8
        fig_height: 4
---

# **Setup and Configuration**

## Load in relevant packages

The [tidyverse](https://www.tidyverse.org/) is a collection of R packages designed for data science. All packages share a similar design philosophy, grammar, and data structures. Tidyverse includes packages such as: ggplot2, dplyr, tidyr, readr, purr, tibble, stringr, lubridate, and forcats.

The [readxl](https://readxl.tidyverse.org/) package is used to easily read in Excel files into R.

The [knitr](https://sachsmc.github.io/knit-git-markr-guide/knitr/knit.html) package is a that integrates computing and reporting.

```{r Setup and Configuration, warning = FALSE, message = FALSE}
library(tidyverse)
library(readxl)
library(knitr)
```

## Load in Movie data

```{r Data Loading}
MOVIE <- read_xlsx("movies.xlsx",
  sheet = "MOVIE"
)

PERSON <- read_xlsx("movies.xlsx",
  sheet = "PERSON"
)

AWARD <- read_xlsx("movies.xlsx",
  sheet = "AWARD"
)

WRITER <- read_xlsx("movies.xlsx",
  sheet = "WRITER"
)

CREW <- read_xlsx("movies.xlsx",
  sheet = "CREW"
)

RESTRICTION <- read_xlsx("movies.xlsx",
  sheet = "RESTRICTION"
)

DIRECTOR <- read_xlsx("movies.xlsx",
  sheet = "DIRECTOR"
)

DIRECTOR_AWARD <- read_xlsx("movies.xlsx",
  sheet = "DIRECTOR_AWARD"
)

WRITER_AWARD <- read_xlsx("movies.xlsx",
  sheet = "WRITER_AWARD"
)
```

# **Assignment Questions**

#### **Question 1**

How many persons were born after 1974 whose first name ends with 'e'? List that number.

```{r Question 1}
PERSON %>%
  mutate(
    first_name_last = first_name %>%
      str_sub(start = -1)
  ) %>%
  filter(
    year_born > 1974,
    first_name_last == "e"
  ) %>%
  count() %>%
  kable()
```

#### **Question 2**

Find the average run time of movie(s) which were produced before 1991 and categorised as 'PG-13' restriction in the USA. List the average as a decimal (round to two decimal places).

*Hint: in PostgreSQL, the function ROUND(x, n) can round x to n decimal places, e.g., if x=0.1129, then ROUND(x, 2) = 0.11.*

```{r Question 2}
MOVIE %>%
  full_join(
    RESTRICTION,
    join_by(title, production_year)
  ) %>%
  filter(
    production_year < 1991,
    description == "PG-13",
    country.y == "USA"
  ) %>%
  summarise(mean_run_time = mean(run_time) %>%
    round(2)) %>%
  kable()
```

#### **Question 3**

Of all the movies that have crew members, how many movies have at most 2 crew members? List that number.

```{r Question 3}
CREW %>% 
  group_by(title, production_year) %>% 
  count() %>%
  ungroup() %>% 
  filter(n <= 2) %>% 
  count() %>% 
  kable()
```


#### **Question 4**

Find director(s) who have never been nominated for a director award. List their count.

*Hint: If an award has been won, then implicitly the winner must have been nominated.*

```{r Question 4}
DIRECTOR %>%
  anti_join(DIRECTOR_AWARD,
            join_by(title, production_year)) %>% 
  count() %>% 
  kable()
```
